<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.18/vue.min.js"></script>

<script>
    var lessonDashboardApp = new Vue({
        el: "#lessonDashboardApp",
        data: {
            vuex: JSON.parse(window.localStorage.getItem('vuex')),
            lesson: {},
            dialogue: {},
            vocab: {},
            expansion: {},
            grammar: {},
            downloads: {},
            questions: {},
            course: {},
        },
        methods: {

            getAPIFetch: async function(api) {

                let results = await fetch(api,{
                    credentials: 'same-origin',
                    headers: {
                        'Accept': 'application/json, text/plain, */*',
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer '+ (this.vuex ? this.vuex.token : '')
                    },
                })
                .then(resp => resp.json())
                .then(res => {
                    return res;
                })

            }

        },
        computed: {
            fetchLessons: function(){
                this.lesson = this.getAPIFetch('/api/v1/lessons/get-lesson?<%= slug %>');

                if (this.lesson && this.lesson.id) {

                    // next
                    // /api/v1/dashboard/course-lessons?courseId=978&exclude[0]=1670&limit=2

                    this.dialogue = this.getAPIFetch('/api/v1/lessons/get-dialogue?lessonId='+this.lesson.id);
                    this.vocab = this.getAPIFetch('/api/v1/lessons/get-vocab?lessonId='+this.lesson.id);
                    this.expansion = this.getAPIFetch('/api/v1/lessons/get-expansion?lessonId='+this.lesson.id);
                    this.grammar = this.getAPIFetch('/api/v1/lessons/get-grammar?lessonId='+this.lesson.id);
                    this.downloads = this.getAPIFetch('/api/v1/lessons/get-downloads?lessonId='+this.lesson.id);
                    this.questions = this.getAPIFetch('/api/v1/lessons/get-questions?lessonId='+this.lesson.id);
                }
            },
        }

    })

    lessonDashboardApp.fetchLessons
    // lessonDashboardApp.dialogue = lessonDashboardApp.getAPIFetch('/api/v1/lessons/get-dialogue?lessonId='+lessonDashboardApp.lesson.id);
    // var vuex = JSON.parse(window.localStorage.getItem('vuex'))
    

</script>